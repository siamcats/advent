name: Manually Assign Copilot to Issue

on:
  workflow_dispatch:
    inputs:
      issue_number:
        description: 'Issueç•ªå·'
        required: true
        type: number

permissions:
  issues: write

jobs:
  assign-copilot:
    runs-on: ubuntu-latest
    timeout-minutes: 1
    
    steps:
      - name: Assign Copilot to Issue
        uses: actions/github-script@v7
        with:
          script: |
            const issueNumber = ${{ github.event.inputs.issue_number }};
            
            try {
              // ã¾ãš@copilotãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
              try {
                const { data: user } = await github.rest.users.getByUsername({
                  username: 'copilot'
                });
                console.log(`âœ… @copilot user found: ${user.login} (ID: ${user.id})`);
              } catch (userError) {
                console.log(`âš ï¸ @copilot user check failed: ${userError.message}`);
              }
              
              // @copilot ã‚’æ‹…å½“è€…ã¨ã—ã¦è¿½åŠ 
              const result = await github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issueNumber,
                assignees: ['copilot']
              });
              
              console.log(`âœ… API call successful. Response status: ${result.status}`);
              console.log(`Current assignees:`, result.data.assignees.map(a => a.login));
              
              if (result.data.assignees.find(a => a.login === 'copilot')) {
                console.log(`âœ… Successfully assigned @copilot to Issue #${issueNumber}`);
              } else {
                console.log(`âš ï¸ API succeeded but @copilot is not in assignees list`);
                console.log(`This may mean @copilot doesn't have access to this repository`);
              }
              
              // ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿
              await github.rest.issues.createComment({
                issue_number: issueNumber,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: `ğŸ¤– **GitHub Copilot Code Agent ã‚’æ‰‹å‹•ã‚¢ã‚µã‚¤ãƒ³ã—ã¾ã—ãŸ**

            CopilotãŒè‡ªå‹•çš„ã«:
            1. âœ… Issueå†…å®¹ã‚’åˆ†æ
            2. âœ… ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
            3. âœ… ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…
            4. âœ… PRã‚’ä½œæˆ

            æ•°åˆ†ãŠå¾…ã¡ãã ã•ã„ã€‚CopilotãŒä½œæ¥­ã‚’é–‹å§‹ã—ã¾ã™...`
              });
              
              console.log(`âœ… Posted comment to Issue #${issueNumber}`);
              
            } catch (error) {
              console.error(`âŒ Error: ${error.message}`);
              
              // ã‚¨ãƒ©ãƒ¼ã®å ´åˆã‚‚ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿
              await github.rest.issues.createComment({
                issue_number: issueNumber,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: `âš ï¸ **Copilotã®ã‚¢ã‚µã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ**

            ã‚¨ãƒ©ãƒ¼: \`${error.message}\`

            è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :
            - ãƒªãƒã‚¸ãƒˆãƒªã§GitHub CopilotãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ãªã„
            - Copilot Code Agentã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒãªã„
            - Copilot Pro/Business/Enterpriseãƒ—ãƒ©ãƒ³ãŒå¿…è¦

            æ‰‹å‹•ã§ \`@copilot\` ã‚’ã‚¢ã‚µã‚¤ãƒ³ã—ã¦ã¿ã¦ãã ã•ã„ã€‚`
              });
              
              throw error;
            }
